<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Incluye el CDN de Tailwind CSS para un estilizado moderno y rápido -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos para el fondo de inicio de sesión con imagen y overlay */
        .login-background {
            background-image: url('uploaded:Screenshot_20250801_150005_com.foxdebug.acodefree.jpg-91efbc98-854c-4a18-b4a1-34d529cfaa6a');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: relative;
        }

        .login-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.85);
            /* Overlay oscuro */
            z-index: -1;
        }

        /* Estilos para el fondo del dashboard con color blanco */
        .dashboard-background {
            background-color: #f7fafc;
            /* Fondo blanco */
            color: #1a202c;
            /* Color de texto oscuro */
        }

        /* Estilos para el botón de navegación y sus efectos de activación */
        .nav-button {
            position: relative;
            transition: all 0.3s ease-in-out;
            border-radius: 0.75rem;
            /* Esquinas redondeadas para el botón base */
            overflow: hidden;
            /* Esto es importante para que el ::before no se salga */
        }

        .nav-button::before {
            content: '';
            position: absolute;
            inset: 0;
            background-color: #0c4a6e;
            /* Fondo azul oscuro elegante */
            border-radius: 0.75rem;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease-in-out;
            z-index: -1;
            border: 2px solid #0ea5e9;
            /* Borde azul sutil */
        }

        .nav-button.active {
            color: #a5f3fc;
            /* Tono azul claro para el ícono y texto */
            transform: scale(1.05);
            /* Ligeramente más grande */
        }

        .nav-button.active::before {
            opacity: 1;
            transform: scale(1);
            box-shadow: 0 4px 10px rgba(14, 165, 233, 0.4);
            /* Sombra azul elegante */
        }

        /* Efecto de sombra y color en hover para botones no activos */
        .nav-button:not(.active):hover {
            color: #a5f3fc;
            transform: scale(1.05);
        }

        /* Estilos para los elementos de materia en la pestaña de materias */
        .materia-item {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .materia-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Clase para rotar el icono de flecha */
        .rotate-90 {
            transform: rotate(90deg);
        }
    </style>
    <!--
        Configuración y lógica de Firebase.
    -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCoeIyKkUbtKLzpr0-FO9vkt9SqsMuQl_k",
            authDomain: "volta-77f5a.firebaseapp.com",
            databaseURL: "https://volta-77f5a-default-rtdb.firebaseio.com",
            projectId: "volta-77f5a",
            storageBucket: "volta-77f5a.firebasestorage.app",
            messagingSenderId: "209382996934",
            appId: "1:209382996934:web:f85f1eccff138ee26a10c7"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let isUserAuthenticated = false; // Bandera para verificar si el usuario ha iniciado sesión
        let currentUserRole = ''; // Almacenar el rol del usuario actual
        let currentUserId = ''; // Almacenar el ID del usuario actual
        let currentStudentMateria = ''; // Almacenar la materia del alumno actual

        // Definimos las materias y sus íconos estáticamente para el dashboard
        const materiasStatic = [{
            nombre: '100 - Sistemas Cad',
            icono: 'imagenes/sistemas.png'
        }, {
            nombre: '200 - Electronica Digital',
            icono: 'imagenes/digital.png'
        }, {
            nombre: '400 - Electronica Industrial',
            icono: 'imagenes/industrial.png'
        }, {
            nombre: '400 - Mantenimiento de Equipos Electronicos',
            icono: 'imagenes/mantenimiento.png'
        }, {
            nombre: '600 - Sistemas Escada',
            icono: 'imagenes/scada.png'
        }, ];


        // Función principal para iniciar sesión.
        async function iniciarSesion() {
            const usuarioInput = document.getElementById("usuario").value;
            const contraseñaInput = document.getElementById("contraseña").value;
            const mensajeDiv = document.getElementById("mensaje");
            mensajeDiv.textContent = "";

            if (!usuarioInput || !contraseñaInput) {
                mensajeDiv.style.color = "#e53e3e";
                mensajeDiv.textContent = "Por favor, ingresa el usuario y la contraseña.";
                return;
            }

            try {
                // 1. Intentar iniciar sesión como administrador
                const usuariosSnapshot = await database.ref('usuarios').once('value');
                let usuarioEncontrado = false;

                usuariosSnapshot.forEach((childSnapshot) => {
                    const usuarioDB = childSnapshot.val().usuario;
                    const contraseñaDB = childSnapshot.val().contraseña;
                    const rolDB = childSnapshot.val().rol;

                    if (usuarioInput.toLowerCase() === usuarioDB.toLowerCase() && contraseñaInput === contraseñaDB) {
                        usuarioEncontrado = true;
                        isUserAuthenticated = true;
                        currentUserRole = rolDB;
                        mensajeDiv.style.color = "#38a169";
                        mensajeDiv.textContent = `¡Bienvenido, administrador ${usuarioDB}!`;

                        // Ocultar el formulario de inicio de sesión
                        document.getElementById("login-container").classList.add('hidden');
                        // Mostrar el dashboard del administrador con fondo blanco
                        document.getElementById("main-dashboard").classList.remove('hidden');
                        document.body.classList.remove('login-background');
                        document.body.classList.add('dashboard-background');

                        // Configurar la barra de navegación para el administrador
                        setupAdminNav();
                        // Mostrar el contenido de la pestaña "Materias" por defecto
                        showTab('materias-content');
                        // Activar el botón de la pestaña "Materias"
                        const materiasButton = document.querySelector('[data-tab="materias-content"]');
                        if (materiasButton) {
                            setActiveButton(materiasButton);
                        }
                    }
                });

                // Si no se encontró un administrador, intentar con los alumnos
                if (!usuarioEncontrado) {
                    const alumnosSnapshot = await database.ref('alumnos').once('value');
                    alumnosSnapshot.forEach((childSnapshot) => {
                        const alumno = childSnapshot.val();
                        if (usuarioInput.toLowerCase() === alumno.usuario.toLowerCase() && contraseñaInput === alumno.contraseña) {
                            usuarioEncontrado = true;
                            isUserAuthenticated = true;
                            currentUserRole = 'alumno';
                            currentUserId = childSnapshot.key;
                            currentStudentMateria = alumno.materia;
                            mensajeDiv.style.color = "#38a169";
                            mensajeDiv.textContent = `¡Bienvenido, alumno ${alumno.nombres}!`;

                            // Ocultar el formulario de inicio de sesión
                            document.getElementById("login-container").classList.add('hidden');
                            // Mostrar el dashboard del alumno
                            document.getElementById("main-dashboard").classList.remove('hidden');
                            document.body.classList.remove('login-background');
                            document.body.classList.add('dashboard-background');

                            // Configurar la barra de navegación para el alumno
                            setupStudentNav();
                            // Mostrar la pestaña "Materias" del alumno por defecto
                            showTab('materias-content');
                            // Activar el botón de la pestaña "Materias"
                            const materiasButton = document.querySelector('[data-tab="materias-content"]');
                            if (materiasButton) {
                                setActiveButton(materiasButton);
                            }
                        }
                    });
                }

                if (!usuarioEncontrado) {
                    mensajeDiv.style.color = "#e53e3e"; // Rojo de Tailwind
                    mensajeDiv.textContent = "Usuario o contraseña incorrectos.";
                }

            } catch (error) {
                console.error(error);
                mensajeDiv.style.color = "#e53e3e";
                mensajeDiv.textContent = "Hubo un error al conectar con la base de datos.";
            }
        }

        // Configura la barra de navegación para el administrador
        function setupAdminNav() {
            const footer = document.getElementById('main-footer');
            footer.innerHTML = `
                <!-- Botón de Materias -->
                <button class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('materias-content')" data-tab="materias-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.488 9.279 5 7.5 5S4.168 5.488 3 6.253v13C4.168 18.488 5.721 18 7.5 18s3.332.488 4.5 1.253m0-13C13.168 5.488 14.721 5 16.5 5s3.332.488 4.5 1.253v13C19.832 18.488 18.279 18 16.5 18s-3.332.488-4.5 1.253">
                        </path>
                    </svg>
                    <span class="text-xs mt-1">Materias</span>
                </button>
                <!-- Botón de Registro -->
                <button
                    class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('registro-content')" data-tab="registro-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M18 11a3 3 0 11-6 0 3 3 0 016 0z">
                        </path>
                    </svg>
                    <span class="text-xs mt-1">Registro</span>
                </button>
                <!-- Botón de Biblioteca (icono de libros) -->
                <button
                    class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('biblioteca-content')" data-tab="biblioteca-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.488 9.279 5 7.5 5S4.168 5.488 3 6.253v13C4.168 18.488 5.721 18 7.5 18s3.332.488 4.5 1.253m0-13C13.168 5.488 14.721 5 16.5 5s3.332.488 4.5 1.253v13C19.832 18.488 18.279 18 16.5 18s-3.332.488-4.5 1.253">
                        </path>
                    </svg>
                    <span class="text-xs mt-1">Biblioteca</span>
                </button>
                <!-- Botón de Info -->
                <button
                    class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('info-content')" data-tab="info-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-xs mt-1">Info</span>
                </button>
            `;
        }

        // Configura la barra de navegación para el alumno
        function setupStudentNav() {
            const footer = document.getElementById('main-footer');
            footer.innerHTML = `
                <!-- Botón de Materias -->
                <button class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('materias-content')" data-tab="materias-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.488 9.279 5 7.5 5S4.168 5.488 3 6.253v13C4.168 18.488 5.721 18 7.5 18s3.332.488 4.5 1.253m0-13C13.168 5.488 14.721 5 16.5 5s3.332.488 4.5 1.253v13C19.832 18.488 18.279 18 16.5 18s-3.332.488-4.5 1.253">
                        </path>
                    </svg>
                    <span class="text-xs mt-1">Materias</span>
                </button>
                <!-- Botón de Software (reemplaza a Registro) -->
                <button
                    class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('software-content')" data-tab="software-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L10.5 21H13.5L14.25 17M15 15H9M17 11V15M17 11H7M7 11V15M17 11H21V7H3V11H7M21 7V3H3V7M21 7H3" />
                    </svg>
                    <span class="text-xs mt-1">Software</span>
                </button>
                <!-- Botón de Biblioteca (icono de libros) -->
                <button
                    class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('biblioteca-content')" data-tab="biblioteca-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.488 9.279 5 7.5 5S4.168 5.488 3 6.253v13C4.168 18.488 5.721 18 7.5 18s3.332.488 4.5 1.253m0-13C13.168 5.488 14.721 5 16.5 5s3.332.488 4.5 1.253v13C19.832 18.488 18.279 18 16.5 18s-3.332.488-4.5 1.253">
                        </path>
                    </svg>
                    <span class="text-xs mt-1">Biblioteca</span>
                </button>
                <!-- Botón de Info -->
                <button
                    class="nav-button flex flex-col items-center p-2 text-gray-400 transition-all duration-300 ease-in-out hover:text-sky-300 rounded-xl"
                    onclick="setActiveButton(this); showTab('info-content')" data-tab="info-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-xs mt-1">Info</span>
                </button>
            `;
        }

        // Función para cerrar sesión
        function cerrarSesion() {
            isUserAuthenticated = false;
            currentUserRole = '';
            currentUserId = '';
            currentStudentMateria = '';
            document.getElementById("main-dashboard").classList.add('hidden');
            document.getElementById("login-container").classList.remove('hidden');
            document.body.classList.remove('dashboard-background');
            document.body.classList.add('login-background');
            document.getElementById("mensaje").textContent = "";
            document.getElementById("usuario").value = "";
            document.getElementById("contraseña").value = "";
            // Limpiar los contenidos de las pestañas
            document.getElementById('welcome-content').innerHTML = '';
            document.getElementById('materias-content').innerHTML = '';
            document.getElementById('registro-content').innerHTML = '';
            document.getElementById('biblioteca-content').innerHTML = '';
            document.getElementById('info-content').innerHTML = '';
            document.getElementById('software-content').innerHTML = '';
        }

        // Agrega un listener para el evento 'keydown' en todo el documento.
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !document.getElementById("login-container").classList.contains('hidden')) {
                iniciarSesion();
            }
        });

        // Función para manejar el estado activo de los botones de la barra de navegación
        function setActiveButton(element) {
            const buttons = document.querySelectorAll('.nav-button');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
        }

        // Función para mostrar la pestaña seleccionada
        function showTab(tabId) {
            // Oculta todos los contenidos
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => {
                content.classList.add('hidden');
            });

            // Muestra el contenido de la pestaña seleccionada
            const selectedContent = document.getElementById(tabId);
            if (selectedContent) {
                selectedContent.classList.remove('hidden');
            }

            // Lógica para cargar contenido dinámico según la pestaña y el rol
            if (tabId === 'materias-content') {
                if (currentUserRole === 'administrador') {
                    cargarMateriasDashboard();
                } else if (currentUserRole === 'alumno') {
                    cargarNoticiasAlumno(); // Carga las noticias primero
                    cargarMateriaAlumno();
                }
            } else if (tabId === 'registro-content' && currentUserRole === 'administrador') {
                cargarMateriasRegistro();
                cargarAlumnos();
            } else if (tabId === 'biblioteca-content') {
                if (currentUserRole === 'administrador') {
                    renderAdminBiblioteca();
                } else if (currentUserRole === 'alumno') {
                    renderStudentBiblioteca();
                }
            } else if (tabId === 'info-content' && currentUserRole === 'administrador') {
                renderAdminInfo();
            } else if (tabId === 'software-content' && currentUserRole === 'alumno') {
                renderStudentSoftware();
            }
        }

        // --- FUNCIONES ESPECÍFICAS PARA EL ADMINISTRADOR ---

        // Función para cargar las materias en el select del formulario de registro
        function cargarMateriasRegistro() {
            const materiaSelect = document.getElementById('materia-select');
            // Limpiar opciones existentes
            if (!materiaSelect) return;
            materiaSelect.innerHTML = '<option value="">Selecciona una materia</option>';
            materiasStatic.forEach(materia => {
                const option = document.createElement('option');
                option.value = materia.nombre;
                option.textContent = materia.nombre;
                materiaSelect.appendChild(option);
            });
        }

        // Función para cargar la lista de materias en el dashboard (con acordeón) para el admin
        function cargarMateriasDashboard() {
            const container = document.getElementById('materias-content');
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Materias y Calificaciones</h1>
                <div id="materias-list-container" class="space-y-4 mb-8"></div>
            `;
            const listContainer = document.getElementById('materias-list-container');
            materiasStatic.forEach(materia => {
                const materiaNombre = materia.nombre;
                const materiaKey = materiaNombre.replace(/\s/g, '-');
                const materiaHtml = `
                    <div class="materia-item w-full bg-white p-4 rounded-xl shadow-md transition duration-200">
                        <div class="flex items-center justify-between" onclick="toggleMateriaDetails('${materiaKey}', '${materiaNombre}')">
                            <div class="flex items-center">
                                <img src="${materia.icono}" alt="Icono de ${materiaNombre}" class="h-10 w-10 text-blue-600 mr-3">
                                <span class="text-lg font-bold text-gray-800">${materiaNombre}</span>
                            </div>
                            <svg id="arrow-${materiaKey}" class="h-6 w-6 text-gray-500 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                        <div id="materia-details-${materiaKey}" class="pl-12 mt-4 space-y-4 hidden">
                            <!-- Los detalles de la materia (tabs) se cargarán aquí -->
                        </div>
                    </div>
                `;
                listContainer.innerHTML += materiaHtml;
            });
        }

        // Función para alternar la visibilidad de los detalles de una materia (calificaciones y ponderaciones)
        function toggleMateriaDetails(materiaKey, materiaNombre) {
            const detailsContainer = document.getElementById(`materia-details-${materiaKey}`);
            const arrow = document.getElementById(`arrow-${materiaKey}`);
            const isVisible = !detailsContainer.classList.contains('hidden');

            if (isVisible) {
                detailsContainer.classList.add('hidden');
                arrow.classList.remove('rotate-90');
            } else {
                detailsContainer.classList.remove('hidden');
                arrow.classList.add('rotate-90');
                renderMateriaTabs(materiaKey, materiaNombre, detailsContainer);
            }
        }

        // Función para renderizar las tabs de Calificaciones y Ponderaciones
        function renderMateriaTabs(materiaKey, materiaNombre, container) {
            container.innerHTML = `
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button class="tab-button inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300"
                                onclick="showMateriaTab('${materiaKey}', '${materiaNombre}', 'calificaciones')" data-tab-name="calificaciones">
                            Calificaciones
                        </button>
                        <button class="tab-button inline-flex items-center py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300"
                                onclick="showMateriaTab('${materiaKey}', '${materiaNombre}', 'ponderaciones')" data-tab-name="ponderaciones">
                            Ponderaciones
                        </button>
                    </nav>
                </div>
                <div id="tab-content-${materiaKey}-calificaciones" class="tab-content-inner mt-4"></div>
                <div id="tab-content-${materiaKey}-ponderaciones" class="tab-content-inner mt-4 hidden"></div>
            `;
            // Por defecto, muestra la pestaña de calificaciones
            showMateriaTab(materiaKey, materiaNombre, 'calificaciones');
        }

        // Función para mostrar una pestaña dentro de la materia
        function showMateriaTab(materiaKey, materiaNombre, tabName) {
            const container = document.getElementById(`materia-details-${materiaKey}`);
            const tabButtons = container.querySelectorAll('.tab-button');
            const tabContents = container.querySelectorAll('.tab-content-inner');

            tabButtons.forEach(btn => {
                if (btn.dataset.tabName === tabName) {
                    btn.classList.add('border-indigo-500', 'text-indigo-600');
                    btn.classList.remove('border-transparent', 'text-gray-500');
                } else {
                    btn.classList.add('border-transparent', 'text-gray-500');
                    btn.classList.remove('border-indigo-500', 'text-indigo-600');
                }
            });

            tabContents.forEach(content => {
                content.classList.add('hidden');
            });

            const selectedContent = document.getElementById(`tab-content-${materiaKey}-${tabName}`);
            selectedContent.classList.remove('hidden');

            if (tabName === 'calificaciones') {
                cargarAlumnosPorMateria(materiaKey, materiaNombre, selectedContent);
            } else if (tabName === 'ponderaciones') {
                renderPonderaciones(materiaKey, selectedContent);
            }
        }


        // Función para cargar los alumnos de una materia específica (para admin)
        function cargarAlumnosPorMateria(materiaKey, materiaNombre, containerElement) {
            containerElement.innerHTML = '<p class="text-gray-500">Cargando alumnos...</p>';
            database.ref('alumnos').orderByChild('materia').equalTo(materiaNombre).on('value', async (snapshot) => {
                containerElement.innerHTML = '';
                if (!snapshot.exists()) {
                    containerElement.innerHTML = '<p class="text-gray-500 text-sm">No hay alumnos inscritos en esta materia.</p>';
                    return;
                }
                // Obtener las ponderaciones para esta materia antes de renderizar a los alumnos
                const ponderaciones = await getPonderaciones(materiaKey);
                snapshot.forEach(alumnoSnapshot => {
                    const alumno = alumnoSnapshot.val();
                    const alumnoId = alumnoSnapshot.key;
                    const nombreCompleto = `${alumno.nombres} ${alumno.apellidoPaterno} ${alumno.apellidoMaterno}`;
                    const alumnoItem = document.createElement('div');
                    alumnoItem.classList.add('w-full', 'bg-gray-100', 'p-3', 'rounded-xl', 'cursor-pointer', 'hover:bg-gray-200', 'transition', 'mb-2');
                    alumnoItem.innerHTML = `
                        <div class="flex items-center justify-between" onclick="toggleStudentGrades('${alumnoId}', '${materiaKey}')">
                            <span class="text-gray-700 font-semibold">${nombreCompleto}</span>
                            <svg id="arrow-for-${alumnoId}" class="h-5 w-5 text-gray-500 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                        <div id="grades-for-${alumnoId}" class="mt-4 p-4 bg-white rounded-lg shadow-inner hidden">
                            <!-- Campos de calificaciones se cargarán aquí -->
                        </div>
                    `;
                    containerElement.appendChild(alumnoItem);
                });
            });
        }

        // Función para alternar la visibilidad de las calificaciones de un alumno (para admin)
        function toggleStudentGrades(alumnoId, materiaKey) {
            const gradesContainer = document.getElementById(`grades-for-${alumnoId}`);
            const arrow = document.getElementById(`arrow-for-${alumnoId}`);
            if (gradesContainer.classList.contains('hidden')) {
                gradesContainer.classList.remove('hidden');
                arrow.classList.add('rotate-90');
                Promise.all([
                    database.ref(`alumnos/${alumnoId}/grades/${materiaKey}`).once('value'),
                    database.ref(`materias/${materiaKey}/ponderaciones`).once('value')
                ]).then(([gradesSnapshot, ponderacionesSnapshot]) => {
                    const grades = gradesSnapshot.val() || {};
                    const ponderaciones = ponderacionesSnapshot.val() || {
                        asistencia: 0,
                        practicas: 0,
                        parciales: 0
                    };
                    renderGrades(alumnoId, materiaKey, gradesContainer, grades, ponderaciones);
                }).catch(error => {
                    gradesContainer.innerHTML = '<p class="text-red-500">Error al cargar las calificaciones.</p>';
                    console.error("Error al cargar calificaciones:", error);
                });
            } else {
                gradesContainer.classList.add('hidden');
                arrow.classList.remove('rotate-90');
            }
        }

        // Función para renderizar los campos de calificaciones para el admin (editables)
        function renderGrades(alumnoId, materiaKey, container, grades = {}, ponderaciones = {}) {
            if (!grades) { grades = {}; }
            container.innerHTML = '';
            const practicas = grades.practicas || {};
            const parciales = grades.parciales || {};
            const asistencia = grades.asistencia !== undefined ? grades.asistencia : 0;
            const notaFinal = calcularNotaFinal(practicas, parciales, asistencia, ponderaciones);

            let html = `
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg shadow-sm flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-700">Nota Final: </h4>
                        <span class="text-2xl font-bold text-indigo-600">${notaFinal.toFixed(2)}</span>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">Asistencia</h4>
                        <div class="space-y-2 mb-4">
                            <div>
                                <label for="${alumnoId}-asistencia" class="block text-sm font-medium text-gray-600">Porcentaje de Asistencia</label>
                                <input type="number" id="${alumnoId}-asistencia" value="${asistencia}" min="0" max="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                        <button onclick="saveAsistencia('${alumnoId}', '${materiaKey}')" class="w-full py-2 px-4 rounded-md text-white font-semibold bg-green-600 hover:bg-green-700 transition">Guardar Asistencia</button>
                        <div id="grades-message-asistencia-${alumnoId}" class="mt-2 text-sm font-medium text-center"></div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">Prácticas</h4>
                        <div class="space-y-2 mb-4">
            `;
            for (let i = 1; i <= 6; i++) {
                const practicaKey = `practica${i}`;
                const practicaValue = practicas[practicaKey] !== undefined ? practicas[practicaKey] : 0;
                html += `
                    <div>
                        <label for="${alumnoId}-${practicaKey}" class="block text-sm font-medium text-gray-600">Práctica ${i}</label>
                        <input type="number" id="${alumnoId}-${practicaKey}" value="${practicaValue}" min="0" max="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                    </div>
                `;
            }
            html += `
                        </div>
                        <button onclick="savePracticas('${alumnoId}', '${materiaKey}')" class="w-full py-2 px-4 rounded-md text-white font-semibold bg-green-600 hover:bg-green-700 transition">Guardar Prácticas</button>
                        <div id="grades-message-practicas-${alumnoId}" class="mt-2 text-sm font-medium text-center"></div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-lg shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-700 mb-4">Parciales</h4>
                        <div class="space-y-2 mb-4">
            `;
            for (let i = 1; i <= 2; i++) {
                const parcialKey = `parcial${i}`;
                const parcialValue = parciales[parcialKey] !== undefined ? parciales[parcialKey] : 0;
                html += `
                    <div>
                        <label for="${alumnoId}-${parcialKey}" class="block text-sm font-medium text-gray-600">Parcial ${i}</label>
                        <input type="number" id="${alumnoId}-${parcialKey}" value="${parcialValue}" min="0" max="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                    </div>
                `;
            }
            html += `
                        </div>
                        <button onclick="saveParciales('${alumnoId}', '${materiaKey}')" class="w-full py-2 px-4 rounded-md text-white font-semibold bg-green-600 hover:bg-green-700 transition">Guardar Parciales</button>
                        <div id="grades-message-parciales-${alumnoId}" class="mt-2 text-sm font-medium text-center"></div>
                    </div>
                </div>
            `;
            container.innerHTML = html;
        }

        // Función para guardar solo la calificación de Asistencia en Firebase
        function saveAsistencia(alumnoId, materiaKey) {
            const gradesMessage = document.getElementById(`grades-message-asistencia-${alumnoId}`);
            gradesMessage.textContent = '';
            const asistenciaValue = parseFloat(document.getElementById(`${alumnoId}-asistencia`).value) || 0;
            database.ref(`alumnos/${alumnoId}/grades/${materiaKey}/asistencia`).set(asistenciaValue)
                .then(() => {
                    gradesMessage.textContent = "Asistencia guardada con éxito.";
                    gradesMessage.style.color = "#38a169";
                })
                .catch(error => {
                    gradesMessage.textContent = "Error al guardar asistencia.";
                    gradesMessage.style.color = "#e53e3e";
                    console.error("Error al guardar asistencia:", error);
                });
        }

        // Función para guardar solo las calificaciones de Prácticas en Firebase
        function savePracticas(alumnoId, materiaKey) {
            const gradesMessage = document.getElementById(`grades-message-practicas-${alumnoId}`);
            gradesMessage.textContent = '';
            const practicas = {};
            for (let i = 1; i <= 6; i++) {
                const key = `practica${i}`;
                const value = document.getElementById(`${alumnoId}-${key}`).value;
                practicas[key] = parseFloat(value) || 0;
            }
            database.ref(`alumnos/${alumnoId}/grades/${materiaKey}/practicas`).update(practicas)
                .then(() => {
                    gradesMessage.textContent = "Prácticas guardadas con éxito.";
                    gradesMessage.style.color = "#38a169";
                })
                .catch(error => {
                    gradesMessage.textContent = "Error al guardar prácticas.";
                    gradesMessage.style.color = "#e53e3e";
                    console.error("Error al guardar prácticas:", error);
                });
        }

        // Función para guardar solo las calificaciones de Parciales en Firebase
        function saveParciales(alumnoId, materiaKey) {
            const gradesMessage = document.getElementById(`grades-message-parciales-${alumnoId}`);
            gradesMessage.textContent = '';
            const parciales = {};
            for (let i = 1; i <= 2; i++) {
                const key = `parcial${i}`;
                const value = document.getElementById(`${alumnoId}-${key}`).value;
                parciales[key] = parseFloat(value) || 0;
            }
            database.ref(`alumnos/${alumnoId}/grades/${materiaKey}/parciales`).update(parciales)
                .then(() => {
                    gradesMessage.textContent = "Parciales guardados con éxito.";
                    gradesMessage.style.color = "#38a169";
                })
                .catch(error => {
                    gradesMessage.textContent = "Error al guardar parciales.";
                    gradesMessage.style.color = "#e53e3e";
                    console.error("Error al guardar parciales:", error);
                });
        }

        // Función para renderizar los campos de ponderaciones
        async function renderPonderaciones(materiaKey, container) {
            container.innerHTML = '<p class="text-gray-500">Cargando ponderaciones...</p>';
            const ponderaciones = await getPonderaciones(materiaKey);
            const {
                asistencia,
                practicas,
                parciales
            } = ponderaciones;

            container.innerHTML = `
                <div class="bg-gray-50 p-6 rounded-xl shadow-md space-y-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Ponderaciones de Calificación</h2>
                    <div class="text-sm font-medium text-red-500" id="ponderaciones-error-message"></div>
                    <div>
                        <label for="ponderacion-asistencia" class="block text-sm font-medium text-gray-700">Asistencia (%)</label>
                        <input type="number" id="ponderacion-asistencia" value="${asistencia}" min="0" max="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="ponderacion-practicas" class="block text-sm font-medium text-gray-700">Prácticas (%)</label>
                        <input type="number" id="ponderacion-practicas" value="${practicas}" min="0" max="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="ponderacion-parciales" class="block text-sm font-medium text-gray-700">Parciales (%)</label>
                        <input type="number" id="ponderacion-parciales" value="${parciales}" min="0" max="100" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4" role="alert">
                      <p class="font-bold">Total</p>
                      <p>La suma de las ponderaciones debe ser 100.</p>
                    </div>
                    <button onclick="savePonderaciones('${materiaKey}')" class="w-full py-2 px-4 rounded-md text-white font-semibold bg-indigo-600 hover:bg-indigo-700 transition duration-300">
                        Guardar Ponderaciones
                    </button>
                </div>
            `;
        }

        // Función para guardar las ponderaciones en Firebase
        function savePonderaciones(materiaKey) {
            const asistencia = parseFloat(document.getElementById('ponderacion-asistencia').value) || 0;
            const practicas = parseFloat(document.getElementById('ponderacion-practicas').value) || 0;
            const parciales = parseFloat(document.getElementById('ponderacion-parciales').value) || 0;

            const total = asistencia + practicas + parciales;
            const errorDiv = document.getElementById('ponderaciones-error-message');

            if (total !== 100) {
                errorDiv.textContent = `Error: La suma de las ponderaciones debe ser 100. Actualmente es ${total}.`;
                return;
            }
            errorDiv.textContent = ''; // Limpiar mensaje de error

            const ponderaciones = {
                asistencia,
                practicas,
                parciales
            };
            database.ref(`materias/${materiaKey}/ponderaciones`).set(ponderaciones)
                .then(() => {
                    showCustomAlert("Ponderaciones guardadas con éxito.");
                })
                .catch(error => {
                    console.error("Error al guardar ponderaciones:", error);
                    showCustomAlert("Error al guardar las ponderaciones.");
                });
        }

        // Función para obtener las ponderaciones de una materia
        async function getPonderaciones(materiaKey) {
            const snapshot = await database.ref(`materias/${materiaKey}/ponderaciones`).once('value');
            return snapshot.val() || {
                asistencia: 0,
                practicas: 0,
                parciales: 0
            };
        }

        // Función para calcular la nota final
        function calcularNotaFinal(practicas, parciales, asistencia, ponderaciones) {
            const ponderacionAsistencia = ponderaciones.asistencia || 0;
            const ponderacionPracticas = ponderaciones.practicas || 0;
            const ponderacionParciales = ponderaciones.parciales || 0;

            // Calcular promedio de prácticas
            const practicasArray = Object.values(practicas).filter(p => p !== null);
            const promedioPracticas = practicasArray.length > 0 ? practicasArray.reduce((acc, curr) => acc + curr, 0) / practicasArray.length : 0;

            // Calcular promedio de parciales
            const parcialesArray = Object.values(parciales).filter(p => p !== null);
            const promedioParciales = parcialesArray.length > 0 ? parcialesArray.reduce((acc, curr) => acc + curr, 0) / parcialesArray.length : 0;

            // Calcular la nota final ponderada
            const notaFinal =
                (asistencia * (ponderacionAsistencia / 100)) +
                (promedioPracticas * (ponderacionPracticas / 100)) +
                (promedioParciales * (ponderacionParciales / 100));

            return notaFinal;
        }

        // Función para registrar un alumno en la base de datos
        async function registrarAlumno() {
            const mensajeRegistro = document.getElementById("mensaje-registro");
            if (!isUserAuthenticated || currentUserRole !== 'administrador') {
                mensajeRegistro.textContent = "Error: Debes iniciar sesión como administrador para registrar alumnos.";
                mensajeRegistro.style.color = "#e53e3e";
                return;
            }
            const apellidoPaterno = document.getElementById("apellido-paterno").value;
            const apellidoMaterno = document.getElementById("apellido-materno").value;
            const nombres = document.getElementById("nombres").value;
            const celular = document.getElementById("celular").value;
            const materia = document.getElementById("materia-select").value;
            const materiaKey = materia.replace(/\s/g, '-');
            const usuario = document.getElementById("usuario-alumno").value;
            const contraseña = document.getElementById("contraseña-alumno").value;

            if (!apellidoPaterno || !apellidoMaterno || !nombres || !celular || !materia || !usuario || !contraseña) {
                mensajeRegistro.textContent = "Por favor, completa todos los campos.";
                mensajeRegistro.style.color = "#e53e3e";
                return;
            }
            const practicasIniciales = {};
            for (let i = 1; i <= 6; i++) { practicasIniciales[`practica${i}`] = 0; }
            const parcialesIniciales = {};
            for (let i = 1; i <= 2; i++) { parcialesIniciales[`parcial${i}`] = 0; }

            const nuevoAlumno = {
                apellidoPaterno, apellidoMaterno, nombres, celular, materia, usuario, contraseña, rol: 'alumno',
                grades: {
                    [materiaKey]: {
                        asistencia: 0,
                        practicas: practicasIniciales,
                        parciales: parcialesIniciales
                    }
                }
            };
            database.ref('alumnos').push(nuevoAlumno)
                .then(() => {
                    mensajeRegistro.textContent = "Alumno registrado con éxito.";
                    mensajeRegistro.style.color = "#38a169";
                    document.getElementById("apellido-paterno").value = "";
                    document.getElementById("apellido-materno").value = "";
                    document.getElementById("nombres").value = "";
                    document.getElementById("celular").value = "";
                    document.getElementById("materia-select").value = "";
                    document.getElementById("usuario-alumno").value = "";
                    document.getElementById("contraseña-alumno").value = "";
                    cargarAlumnos();
                })
                .catch((error) => {
                    mensajeRegistro.textContent = "Error al registrar el alumno: Por favor, revisa tus reglas de seguridad de Firebase.";
                    mensajeRegistro.style.color = "#e53e3e";
                    console.error("Error al registrar: ", error);
                });
        }

        // Función para cargar los alumnos registrados en tiempo real (para admin)
        function cargarAlumnos() {
            const resultadosDiv = document.getElementById('resultados-alumnos');
            if (!resultadosDiv) return;
            resultadosDiv.innerHTML = '<p class="text-gray-500">Cargando alumnos...</p>';
            database.ref('alumnos').on('value', (snapshot) => {
                resultadosDiv.innerHTML = '';
                if (!snapshot.exists()) {
                    resultadosDiv.innerHTML = '<p class="text-gray-500">No hay alumnos registrados.</p>';
                    return;
                }
                snapshot.forEach((childSnapshot) => {
                    const alumno = childSnapshot.val();
                    const alumnoId = childSnapshot.key;
                    const alumnoItem = document.createElement('div');
                    alumnoItem.classList.add('bg-white', 'p-4', 'rounded-md', 'shadow-sm', 'flex', 'items-center', 'justify-between');
                    alumnoItem.innerHTML = `
                        <div>
                            <p class="font-semibold text-gray-800">${alumno.nombres} ${alumno.apellidoPaterno} ${alumno.apellidoMaterno}</p>
                            <p class="text-sm text-gray-600">Usuario: ${alumno.usuario} | Celular: ${alumno.celular} | Materia: ${alumno.materia}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="modificarAlumno('${alumnoId}')" class="py-1 px-3 bg-yellow-500 text-white rounded-md text-sm hover:bg-yellow-600 transition">Modificar</button>
                            <button onclick="eliminarAlumno('${alumnoId}')" class="py-1 px-3 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition">Eliminar</button>
                        </div>
                    `;
                    resultadosDiv.appendChild(alumnoItem);
                });
            });
        }

        // Función para buscar alumnos (placeholder)
        function buscarAlumno() {
            const apellidoBusqueda = document.getElementById("filtro-apellido").value.toLowerCase();
            const alumnosRef = database.ref('alumnos');
            const resultadosDiv = document.getElementById('resultados-alumnos');
            alumnosRef.once('value').then(snapshot => {
                resultadosDiv.innerHTML = '';
                let encontrado = false;
                snapshot.forEach(childSnapshot => {
                    const alumno = childSnapshot.val();
                    if (alumno.apellidoPaterno.toLowerCase().includes(apellidoBusqueda) ||
                        alumno.apellidoMaterno.toLowerCase().includes(apellidoBusqueda) ||
                        alumno.nombres.toLowerCase().includes(apellidoBusqueda)) {
                        const alumnoId = childSnapshot.key;
                        const alumnoItem = document.createElement('div');
                        alumnoItem.classList.add('bg-white', 'p-4', 'rounded-md', 'shadow-sm', 'flex', 'items-center', 'justify-between');
                        alumnoItem.innerHTML = `
                            <div>
                                <p class="font-semibold text-gray-800">${alumno.nombres} ${alumno.apellidoPaterno} ${alumno.apellidoMaterno}</p>
                                <p class="text-sm text-gray-600">Usuario: ${alumno.usuario} | Celular: ${alumno.celular} | Materia: ${alumno.materia}</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="modificarAlumno('${alumnoId}')" class="py-1 px-3 bg-yellow-500 text-white rounded-md text-sm hover:bg-yellow-600 transition">Modificar</button>
                                <button onclick="eliminarAlumno('${alumnoId}')" class="py-1 px-3 bg-red-500 text-white rounded-md text-sm hover:bg-red-600 transition">Eliminar</button>
                            </div>
                        `;
                        resultadosDiv.appendChild(alumnoItem);
                        encontrado = true;
                    }
                });
                if (!encontrado) {
                    resultadosDiv.innerHTML = '<p class="text-gray-500">No se encontraron alumnos con ese nombre o apellido.</p>';
                }
            });
        }

        // Función para abrir el modal de modificación de alumno
        function modificarAlumno(alumnoId) {
            database.ref('alumnos/' + alumnoId).once('value').then(snapshot => {
                const alumno = snapshot.val();
                if (!alumno) return;
                const modal = document.getElementById('modificar-modal');
                document.getElementById('edit-alumnoId').value = alumnoId;
                document.getElementById('edit-apellido-paterno').value = alumno.apellidoPaterno;
                document.getElementById('edit-apellido-materno').value = alumno.apellidoMaterno;
                document.getElementById('edit-nombres').value = alumno.nombres;
                document.getElementById('edit-celular').value = alumno.celular;
                const materiaSelect = document.getElementById('edit-materia-select');
                materiaSelect.innerHTML = '';
                materiasStatic.forEach(materia => {
                    const materiaTexto = materia.nombre;
                    const option = document.createElement('option');
                    option.value = materiaTexto;
                    option.textContent = materiaTexto;
                    if (materiaTexto === alumno.materia) { option.selected = true; }
                    materiaSelect.appendChild(option);
                });
                document.getElementById('edit-usuario-alumno').value = alumno.usuario;
                document.getElementById('edit-contraseña-alumno').value = alumno.contraseña;
                modal.classList.remove('hidden');
            }).catch(error => {
                console.error("Error al cargar datos del alumno para modificar:", error);
            });
        }

        // Función para cerrar el modal de modificación
        function cerrarModificarModal() {
            document.getElementById('modificar-modal').classList.add('hidden');
        }

        // Función para guardar los cambios de un alumno
        function guardarCambiosAlumno() {
            const alumnoId = document.getElementById('edit-alumnoId').value;
            const updatedAlumno = {
                apellidoPaterno: document.getElementById('edit-apellido-paterno').value,
                apellidoMaterno: document.getElementById('edit-apellido-materno').value,
                nombres: document.getElementById('edit-nombres').value,
                celular: document.getElementById('edit-celular').value,
                materia: document.getElementById('edit-materia-select').value,
                usuario: document.getElementById('edit-usuario-alumno').value,
                contraseña: document.getElementById('edit-contraseña-alumno').value,
                rol: 'alumno'
            };
            database.ref('alumnos/' + alumnoId).update(updatedAlumno)
                .then(() => {
                    cerrarModificarModal();
                    showCustomAlert('Alumno actualizado con éxito.');
                })
                .catch(error => {
                    console.error("Error al actualizar el alumno:", error);
                    showCustomAlert('Error al actualizar el alumno.');
                });
        }

        // Función para eliminar un alumno
        function eliminarAlumno(alumnoId) {
            const confirmDialog = document.createElement('div');
            confirmDialog.classList.add('fixed', 'inset-0', 'bg-gray-900', 'bg-opacity-75', 'flex', 'items-center', 'justify-center', 'z-50');
            confirmDialog.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                    <p class="text-lg font-semibold text-gray-800 mb-4">¿Estás seguro?</p>
                    <p class="text-sm text-gray-600 mb-6">Esta acción no se puede deshacer.</p>
                    <div class="flex justify-end space-x-4">
                        <button class="py-2 px-4 rounded-md text-gray-700 font-semibold bg-gray-200 hover:bg-gray-300 transition" onclick="closeDialog()">Cancelar</button>
                        <button class="py-2 px-4 rounded-md text-white font-semibold bg-red-600 hover:bg-red-700 transition" onclick="deleteAndClose('${alumnoId}')">Eliminar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDialog);

            window.closeDialog = () => { document.body.removeChild(confirmDialog); };
            window.deleteAndClose = (id) => {
                database.ref('alumnos/' + id).remove()
                    .then(() => {
                        console.log("Alumno eliminado con éxito.");
                        closeDialog();
                    })
                    .catch((error) => {
                        console.error("Error al eliminar el alumno:", error);
                        closeDialog();
                    });
            };
        }

        // --- NUEVAS FUNCIONES PARA LA LÓGICA DE BIBLIOTECA Y NOTICIAS ---

        // Función para generar un código único y secuencial
        async function generarCodigo(prefijo) {
            const codigoRef = database.ref(`codigo_counters/${prefijo}`);
            let ultimoNumero = (await codigoRef.once('value')).val() || 0;
            ultimoNumero++;
            await codigoRef.set(ultimoNumero);
            return `${prefijo}-${String(ultimoNumero).padStart(3, '0')}`;
        }

        // Función para agregar un recurso a la biblioteca (Admin)
        async function agregarRecurso() {
            const codigoPrefijo = document.getElementById('recurso-codigo-prefijo').value;
            const titulo = document.getElementById('recurso-titulo').value;
            const link = document.getElementById('recurso-link').value;
            const tipo = document.getElementById('recurso-tipo').value;
            const mensajeDiv = document.getElementById('mensaje-recurso');

            if (!codigoPrefijo || !titulo || !link || !tipo) {
                mensajeDiv.textContent = "Por favor, completa todos los campos.";
                mensajeDiv.style.color = "#e53e3e";
                return;
            }

            try {
                const codigo = await generarCodigo(codigoPrefijo);
                const nuevoRecurso = {
                    codigo,
                    titulo,
                    link,
                    tipo,
                    timestamp: Date.now()
                };
                await database.ref('biblioteca').push(nuevoRecurso);
                mensajeDiv.textContent = "Recurso añadido con éxito.";
                mensajeDiv.style.color = "#38a169";
                document.getElementById('recurso-titulo').value = '';
                document.getElementById('recurso-link').value = '';
            } catch (error) {
                console.error("Error al agregar recurso:", error);
                mensajeDiv.textContent = "Error al agregar el recurso.";
                mensajeDiv.style.color = "#e53e3e";
            }
        }

        // Función para renderizar la pestaña de biblioteca para el administrador
        function renderAdminBiblioteca() {
            const container = document.getElementById('biblioteca-content');
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Gestión de Biblioteca</h1>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Añadir Nuevo Recurso</h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="recurso-codigo-prefijo" class="block text-sm font-medium text-gray-700">Código</label>
                                <select id="recurso-codigo-prefijo" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                    <option value="ELT">ELT</option>
                                    <option value="ELTN">ELTN</option>
                                </select>
                            </div>
                            <div>
                                <label for="recurso-tipo" class="block text-sm font-medium text-gray-700">Tipo</label>
                                <select id="recurso-tipo" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                                    <option value="libro">Libro</option>
                                    <option value="software">Software</option>
                                    <option value="video">Video</option>
                                    <option value="practica">Práctica</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="recurso-titulo" class="block text-sm font-medium text-gray-700">Título del Recurso</label>
                            <input type="text" id="recurso-titulo" placeholder="Ej: Introducción a la electrónica" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="recurso-link" class="block text-sm font-medium text-gray-700">Link de Descarga</label>
                            <input type="url" id="recurso-link" placeholder="Ej: https://ejemplo.com/recurso.pdf" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <button onclick="agregarRecurso()" class="w-full py-2 px-4 rounded-md text-white font-semibold bg-indigo-600 hover:bg-indigo-700 transition">
                            Añadir Recurso
                        </button>
                        <div id="mensaje-recurso" class="mt-2 text-sm font-medium text-center"></div>
                    </div>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Recursos Existentes</h2>
                    <div id="recursos-table-container"></div>
                </div>
            `;
            // Cargar la tabla de recursos
            renderAdminRecursosTable();
        }

        // Renderiza la tabla de recursos para el administrador con opciones de eliminación
        function renderAdminRecursosTable() {
            const container = document.getElementById('recursos-table-container');
            container.innerHTML = `<p class="text-gray-500">Cargando recursos...</p>`;
            database.ref('biblioteca').on('value', (snapshot) => {
                const recursos = snapshot.val();
                if (!recursos) {
                    container.innerHTML = `<p class="text-gray-500 text-sm">No hay recursos en la biblioteca.</p>`;
                    return;
                }
                const html = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 rounded-lg shadow-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Link</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${Object.keys(recursos).map(key => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${recursos[key].codigo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${recursos[key].titulo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600"><a href="${recursos[key].link}" target="_blank" class="hover:underline">Descargar</a></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${recursos[key].tipo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button onclick="eliminarRecurso('${key}')" class="text-red-600 hover:text-red-900">Eliminar</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                container.innerHTML = html;
            });
        }

        // Función para eliminar un recurso de la biblioteca
        function eliminarRecurso(recursoId) {
            database.ref('biblioteca/' + recursoId).remove()
                .then(() => {
                    showCustomAlert("Recurso eliminado con éxito.");
                })
                .catch(error => {
                    console.error("Error al eliminar el recurso:", error);
                    showCustomAlert("Error al eliminar el recurso.");
                });
        }

        // Función para renderizar la vista de biblioteca para el alumno (solo lectura)
        function renderStudentBiblioteca() {
            const container = document.getElementById('biblioteca-content');
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Biblioteca de Recursos</h1>
                <div id="student-recursos-table-container"></div>
            `;
            const tableContainer = document.getElementById('student-recursos-table-container');
            tableContainer.innerHTML = `<p class="text-gray-500">Cargando recursos...</p>`;
            database.ref('biblioteca').orderByChild('tipo').on('value', (snapshot) => {
                const recursos = [];
                snapshot.forEach(childSnapshot => {
                    const recurso = childSnapshot.val();
                    if (recurso.tipo === 'libro' || recurso.tipo === 'practica') {
                        recursos.push(recurso);
                    }
                });
                if (recursos.length === 0) {
                    tableContainer.innerHTML = `<p class="text-gray-500 text-sm">No hay recursos de tipo libro o práctica disponibles.</p>`;
                    return;
                }
                const html = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 rounded-lg shadow-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Link</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${recursos.map(recurso => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${recurso.codigo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${recurso.titulo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${recurso.tipo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600"><a href="${recurso.link}" target="_blank" class="hover:underline">Descargar</a></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                tableContainer.innerHTML = html;
            });
        }

        // Función para renderizar la vista de software para el alumno (solo lectura)
        function renderStudentSoftware() {
            const container = document.getElementById('software-content');
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Software y Multimedia</h1>
                <div id="student-software-table-container"></div>
            `;
            const tableContainer = document.getElementById('student-software-table-container');
            tableContainer.innerHTML = `<p class="text-gray-500">Cargando recursos...</p>`;
            database.ref('biblioteca').orderByChild('tipo').on('value', (snapshot) => {
                const recursos = [];
                snapshot.forEach(childSnapshot => {
                    const recurso = childSnapshot.val();
                    if (recurso.tipo === 'software' || recurso.tipo === 'video') {
                        recursos.push(recurso);
                    }
                });
                if (recursos.length === 0) {
                    tableContainer.innerHTML = `<p class="text-gray-500 text-sm">No hay recursos de software o video disponibles.</p>`;
                    return;
                }
                const html = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 rounded-lg shadow-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Link</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${recursos.map(recurso => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${recurso.codigo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${recurso.titulo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${recurso.tipo}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600"><a href="${recurso.link}" target="_blank" class="hover:underline">Descargar</a></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                tableContainer.innerHTML = html;
            });
        }

        // Función para renderizar la pestaña de información para el administrador
        function renderAdminInfo() {
            const container = document.getElementById('info-content');
            container.innerHTML = `
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Página de Información</h1>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Publicar Noticias</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="noticia-textarea" class="block text-sm font-medium text-gray-700">Contenido de la Noticia</label>
                            <textarea id="noticia-textarea" rows="4" placeholder="Escribe aquí la noticia o anuncio..." class="mt-1 w-full p-2 border border-gray-300 rounded-md"></textarea>
                        </div>
                        <button onclick="publicarNoticia()" class="w-full py-2 px-4 rounded-md text-white font-semibold bg-blue-600 hover:bg-blue-700 transition">
                            Publicar
                        </button>
                        <div id="mensaje-noticia" class="mt-2 text-sm font-medium text-center"></div>
                    </div>
                </div>
                <!-- Aquí se podría añadir otra sección para ver noticias publicadas -->
                <p class="text-gray-600 text-lg">Información general del instituto.</p>
            `;
        }

        // Función para publicar una noticia
        async function publicarNoticia() {
            const noticiaTextarea = document.getElementById('noticia-textarea');
            const mensajeDiv = document.getElementById('mensaje-noticia');
            if (!noticiaTextarea.value) {
                mensajeDiv.textContent = "La noticia no puede estar vacía.";
                mensajeDiv.style.color = "#e53e3e";
                return;
            }
            try {
                const nuevaNoticia = {
                    contenido: noticiaTextarea.value,
                    timestamp: Date.now()
                };
                await database.ref('noticias').push(nuevaNoticia);
                mensajeDiv.textContent = "Noticia publicada con éxito.";
                mensajeDiv.style.color = "#38a169";
                noticiaTextarea.value = '';
            } catch (error) {
                console.error("Error al publicar la noticia:", error);
                mensajeDiv.textContent = "Error al publicar la noticia.";
                mensajeDiv.style.color = "#e53e3e";
            }
        }

        // Función para cargar las noticias en la vista del alumno
        function cargarNoticiasAlumno() {
            const noticiasContainer = document.getElementById('noticias-alumno-container');
            if (!noticiasContainer) return; // Salir si el contenedor no existe
            noticiasContainer.innerHTML = '<p class="text-gray-500">Cargando noticias...</p>';
            database.ref('noticias').orderByChild('timestamp').limitToLast(3).on('value', (snapshot) => {
                const noticias = [];
                snapshot.forEach(childSnapshot => noticias.push(childSnapshot.val()));
                noticias.reverse(); // Mostrar las más recientes primero
                if (noticias.length === 0) {
                    noticiasContainer.innerHTML = '';
                    return;
                }
                const html = `
                    <div class="bg-blue-50 p-4 rounded-xl shadow-md mb-6">
                        <h2 class="text-2xl font-bold text-blue-800 mb-4">Noticias</h2>
                        ${noticias.map(noticia => `
                            <div class="border-b border-blue-200 last:border-b-0 py-2">
                                <p class="text-sm text-gray-700">${noticia.contenido}</p>
                                <p class="text-xs text-gray-500 mt-1">Publicado el ${new Date(noticia.timestamp).toLocaleDateString()}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                noticiasContainer.innerHTML = html;
            });
        }

        // --- FUNCIONES ESPECÍFICAS PARA EL ALUMNO ---

        // Función para cargar la materia y calificaciones del alumno logueado
        function cargarMateriaAlumno() {
            const container = document.getElementById('materias-content');
            // Mantener el contenedor de noticias y solo actualizar el resto
            if (!document.getElementById('noticias-alumno-container')) {
                container.innerHTML = `
                    <div id="noticias-alumno-container"></div>
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Mis Calificaciones</h1>
                    <div id="student-materia-container" class="space-y-4 mb-8"></div>
                `;
            }
            const materiaContainer = document.getElementById('student-materia-container');
            const materiaInfo = materiasStatic.find(m => m.nombre === currentStudentMateria);

            if (!materiaInfo) {
                materiaContainer.innerHTML = '<p class="text-red-500">No se encontró la información de la materia.</p>';
                return;
            }
            const materiaKey = currentStudentMateria.replace(/\s/g, '-');
            materiaContainer.innerHTML = `
                <div class="materia-item w-full bg-white p-4 rounded-xl shadow-md transition duration-200" onclick="toggleStudentReadOnlyGrades('${currentUserId}', '${materiaKey}')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <img src="${materiaInfo.icono}" alt="Icono de ${materiaInfo.nombre}" class="h-10 w-10 text-blue-600 mr-3">
                            <span class="text-lg font-bold text-gray-800">${materiaInfo.nombre}</span>
                        </div>
                        <svg id="arrow-student-grades" class="h-6 w-6 text-gray-500 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </div>
                    <div id="grades-read-only" class="pl-12 mt-4 space-y-2 hidden">
                        <!-- Las calificaciones de solo lectura se cargarán aquí -->
                    </div>
                </div>
            `;
        }

        // Función para alternar la visibilidad de las calificaciones del alumno (solo lectura)
        function toggleStudentReadOnlyGrades(alumnoId, materiaKey) {
            const gradesContainer = document.getElementById('grades-read-only');
            const arrow = document.getElementById('arrow-student-grades');
            const isVisible = !gradesContainer.classList.contains('hidden');

            if (isVisible) {
                gradesContainer.classList.add('hidden');
                arrow.classList.remove('rotate-90');
            } else {
                cargarCalificacionesAlumno(alumnoId, materiaKey, gradesContainer);
                gradesContainer.classList.remove('hidden');
                arrow.classList.add('rotate-90');
            }
        }

        // Función para cargar y renderizar las calificaciones del alumno (solo lectura)
        function cargarCalificacionesAlumno(alumnoId, materiaKey, container) {
            container.innerHTML = '<p class="text-gray-500">Cargando calificaciones...</p>';
            Promise.all([
                database.ref(`alumnos/${alumnoId}/grades/${materiaKey}`).once('value'),
                database.ref(`materias/${materiaKey}/ponderaciones`).once('value')
            ]).then(([gradesSnapshot, ponderacionesSnapshot]) => {
                const grades = gradesSnapshot.val() || {};
                const ponderaciones = ponderacionesSnapshot.val() || {
                    asistencia: 0,
                    practicas: 0,
                    parciales: 0
                };
                const practicas = grades.practicas || {};
                const parciales = grades.parciales || {};
                const asistencia = grades.asistencia !== undefined ? grades.asistencia : 'No calificado';
                const notaFinal = calcularNotaFinal(practicas, parciales, asistencia, ponderaciones);

                let html = `<div class="space-y-4">`;
                html += `
                    <div class="p-4 bg-gray-100 rounded-lg shadow-inner flex justify-between items-center">
                        <h4 class="text-lg font-semibold text-gray-700">Nota Final: </h4>
                        <span class="text-2xl font-bold text-indigo-600">${notaFinal.toFixed(2)}</span>
                    </div>
                `;

                html += `
                    <div class="p-4 bg-gray-100 rounded-lg shadow-inner">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Asistencia</h4>
                        <p class="text-gray-600">Porcentaje: <span class="font-bold">${asistencia}%</span></p>
                    </div>
                `;

                html += `
                    <div class="p-4 bg-gray-100 rounded-lg shadow-inner">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Prácticas</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-600">
                `;
                for (let i = 1; i <= 6; i++) {
                    const practicaKey = `practica${i}`;
                    const value = practicas[practicaKey] !== undefined ? practicas[practicaKey] : 'No calificado';
                    html += `<li>Práctica ${i}: <span class="font-bold">${value}</span></li>`;
                }
                html += `</ul></div>`;

                html += `
                    <div class="p-4 bg-gray-100 rounded-lg shadow-inner">
                        <h4 class="text-lg font-semibold text-gray-700 mb-2">Parciales</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-600">
                `;
                for (let i = 1; i <= 2; i++) {
                    const parcialKey = `parcial${i}`;
                    const value = parciales[parcialKey] !== undefined ? parciales[parcialKey] : 'No calificado';
                    html += `<li>Parcial ${i}: <span class="font-bold">${value}</span></li>`;
                }
                html += `</ul></div>`;
                html += `</div>`;
                container.innerHTML = html;
            }).catch(error => {
                container.innerHTML = '<p class="text-red-500">Error al cargar las calificaciones.</p>';
                console.error("Error al cargar calificaciones del alumno:", error);
            });
        }


        // Función para mostrar un modal de alerta personalizado
        function showCustomAlert(message) {
            const alertModal = document.createElement('div');
            alertModal.classList.add('fixed', 'inset-0', 'bg-gray-900', 'bg-opacity-75', 'flex', 'items-center', 'justify-center', 'z-50');
            alertModal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                    <p class="text-lg font-semibold text-gray-800 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="py-2 px-4 rounded-md text-white font-semibold bg-blue-600 hover:bg-blue-700 transition" onclick="closeAlert()">Cerrar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(alertModal);

            window.closeAlert = () => { document.body.removeChild(alertModal); };
        }
    </script>
</head>

<body class="flex items-center justify-center min-h-screen p-4 login-background">
    <!-- Contenedor principal del formulario de inicio de sesión -->
    <div id="login-container"
        class="bg-gray-800/30 p-8 md:p-12 rounded-2xl shadow-2xl w-full max-w-md text-center border border-gray-700 backdrop-filter backdrop-blur-lg transition duration-500">
        <!-- Título principal -->
        <h2 class="text-3xl font-bold text-gray-100 mb-6 tracking-wide">Inicio de Sesión</h2>

        <!-- Grupo para el campo de usuario -->
        <div class="form-group mb-6 text-left">
            <label for="usuario" class="block text-sm font-medium text-gray-400 mb-2">Usuario</label>
            <input type="text" id="usuario" placeholder="Ingresa tu usuario"
                class="w-full p-3 bg-gray-700/50 text-white border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition duration-300">
        </div>

        <!-- Grupo para el campo de contraseña -->
        <div class="form-group mb-8 text-left">
            <label for="contraseña" class="block text-sm font-medium text-gray-400 mb-2">Contraseña</label>
            <input type="password" id="contraseña" placeholder="Ingresa tu contraseña"
                class="w-full p-3 bg-gray-700/50 text-white border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition duration-300">
        </div>

        <!-- Botón para iniciar sesión -->
        <button
            class="w-full py-3 px-4 rounded-lg text-lg font-semibold text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/50 transition duration-300 ease-in-out transform hover:-translate-y-1 hover:scale-105"
            onclick="iniciarSesion()">
            Entrar
        </button>

        <!-- Espacio para mensajes de estado -->
        <div id="mensaje" class="mt-6 text-sm font-medium"></div>
    </div>

    <!-- Contenedor del Dashboard Unificado (inicialmente oculto) -->
    <div id="main-dashboard" class="hidden flex flex-col justify-between h-screen w-full transition duration-500">
        <!-- Encabezado fijo del dashboard -->
        <header class="fixed top-0 left-0 right-0 z-50 bg-white p-4 flex items-center justify-between shadow-md">
            <!-- Logo y nombre del instituto -->
            <div class="flex items-center">
                <img src="logo.png" alt="Logo del Instituto Tecnológico" class="h-12 w-auto mr-2">
                <span class="text-xl font-bold text-gray-800">INSTITUTO TECNOLOGICO</span>
            </div>
            <!-- Botón de Cerrar Sesión -->
            <button onclick="cerrarSesion()"
                class="py-2 px-4 rounded-lg text-sm font-semibold text-white bg-red-600 hover:bg-red-700 transition duration-300 ease-in-out">
                Cerrar Sesión
            </button>
        </header>

        <!-- Contenido principal del dashboard -->
        <main class="flex-grow p-4 md:p-8 overflow-y-auto bg-white rounded-lg shadow-md m-4 md:m-8 mt-20">

            <!-- Contenido de la pestaña de bienvenida (visible al iniciar sesión) -->
            <div id="welcome-content" class="tab-content hidden">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Bienvenido</h1>
            </div>

            <!-- Contenido de la pestaña "Materias" -->
            <div id="materias-content" class="tab-content hidden">
                <!-- El contenido se generará dinámicamente según el rol -->
            </div>

            <!-- Contenido de la pestaña "Registro" (solo para admin) -->
            <div id="registro-content" class="tab-content hidden">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Gestión de Alumnos</h1>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Registro de Alumnos</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="apellido-paterno" class="block text-sm font-medium text-gray-700">Apellido
                                Paterno</label>
                            <input type="text" id="apellido-paterno" placeholder="Ingresa el apellido paterno"
                                class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                        </div>
                        <div>
                            <label for="apellido-materno" class="block text-sm font-medium text-gray-700">Apellido
                                Materno</label>
                            <input type="text" id="apellido-materno" placeholder="Ingresa el apellido materno"
                                class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                        </div>
                        <div>
                            <label for="nombres" class="block text-sm font-medium text-gray-700">Nombres</label>
                            <input type="text" id="nombres" placeholder="Ingresa los nombres"
                                class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                        </div>
                        <div>
                            <label for="celular" class="block text-sm font-medium text-gray-700">Número de
                                Celular</label>
                            <input type="text" id="celular" placeholder="Ingresa el número de celular"
                                class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                        </div>
                        <div>
                            <label for="materia-select"
                                class="block text-sm font-medium text-gray-700">Materia</label>
                            <select id="materia-select"
                                class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                                <option value="">Selecciona una materia</option>
                            </select>
                        </div>
                        <div>
                            <label for="usuario-alumno"
                                class="block text-sm font-medium text-gray-700">Usuario</label>
                            <input type="text" id="usuario-alumno" placeholder="Ingresa el usuario (ej: jdoe123)"
                                class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                        </div>
                        <div>
                            <label for="contraseña-alumno"
                                class="block text-sm font-medium text-gray-700">Contraseña</label>
                            <input type="password" id="contraseña-alumno" placeholder="Ingresa la contraseña"
                                class="mt-1 w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                        </div>
                        <button onclick="registrarAlumno()"
                            class="w-full py-2 px-4 rounded-md text-white font-semibold bg-indigo-600 hover:bg-indigo-700 transition duration-300">
                            Registrar Alumno
                        </button>
                        <div id="mensaje-registro" class="mt-2 text-sm font-medium text-center"></div>
                    </div>
                </div>
                <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Alumnos Registrados</h2>
                    <div class="flex items-center mb-4 space-x-2">
                        <input type="text" id="filtro-apellido" placeholder="Buscar por nombre o apellido"
                            class="flex-grow p-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200 transition duration-200">
                        <button onclick="buscarAlumno()"
                            class="py-2 px-4 rounded-md text-white font-semibold bg-blue-600 hover:bg-blue-700 transition duration-300">
                            Buscar
                        </button>
                    </div>
                    <div id="resultados-alumnos" class="space-y-2">
                        <p class="text-gray-500">Los resultados de la búsqueda aparecerán aquí.</p>
                    </div>
                </div>
            </div>

            <!-- Contenido de la pestaña "Software" (solo para alumnos) -->
            <div id="software-content" class="tab-content hidden">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Página de Software</h1>
                <p class="text-gray-600 text-lg">Aquí se mostrarán los recursos y enlaces a software para los alumnos.</p>
            </div>

            <!-- Contenido de la pestaña "Biblioteca" -->
            <div id="biblioteca-content" class="tab-content hidden">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Página de Biblioteca</h1>
                <p class="text-gray-600 text-lg">Aquí se mostrará la información de la biblioteca.</p>
            </div>

            <!-- Contenido de la pestaña "Info" -->
            <div id="info-content" class="tab-content hidden">
                <h1 class="text-4xl font-extrabold text-gray-900 mb-6">Página de Información</h1>
                <p class="text-gray-600 text-lg">Aquí se mostrará la información adicional.</p>
            </div>
        </main>

        <!-- Barra de navegación inferior (se llena dinámicamente) -->
        <footer id="main-footer" class="bg-gray-950/90 backdrop-blur-lg fixed bottom-0 left-0 right-0 p-2 border-t border-gray-800 flex justify-around items-center rounded-t-xl shadow-lg">
            <!-- Los botones de navegación se cargarán aquí dinámicamente -->
        </footer>
    </div>

    <!-- Modal de Modificación de Alumnos (inicialmente oculto) -->
    <div id="modificar-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Modificar Alumno</h2>
                <button onclick="cerrarModificarModal()" class="text-gray-500 hover:text-gray-700 text-2xl leading-none">&times;</button>
            </div>
            <div class="space-y-4">
                <input type="hidden" id="edit-alumnoId">
                <div>
                    <label for="edit-apellido-paterno" class="block text-sm font-medium text-gray-700">Apellido Paterno</label>
                    <input type="text" id="edit-apellido-paterno" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="edit-apellido-materno" class="block text-sm font-medium text-gray-700">Apellido Materno</label>
                    <input type="text" id="edit-apellido-materno" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="edit-nombres" class="block text-sm font-medium text-gray-700">Nombres</label>
                    <input type="text" id="edit-nombres" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="edit-celular" class="block text-sm font-medium text-gray-700">Número de Celular</label>
                    <input type="text" id="edit-celular" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="edit-materia-select" class="block text-sm font-medium text-gray-700">Materia</label>
                    <select id="edit-materia-select" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                        <!-- Opciones cargadas dinámicamente -->
                    </select>
                </div>
                <div>
                    <label for="edit-usuario-alumno" class="block text-sm font-medium text-gray-700">Usuario</label>
                    <input type="text" id="edit-usuario-alumno" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="edit-contraseña-alumno" class="block text-sm font-medium text-gray-700">Contraseña</label>
                    <input type="password" id="edit-contraseña-alumno" class="mt-1 w-full p-2 border border-gray-300 rounded-md">
                </div>
            </div>
            <div class="flex justify-end space-x-4 mt-6">
                <button onclick="cerrarModificarModal()" class="py-2 px-4 rounded-md text-gray-700 font-semibold bg-gray-200 hover:bg-gray-300 transition">Cancelar</button>
                <button onclick="guardarCambiosAlumno()" class="py-2 px-4 rounded-md text-white font-semibold bg-indigo-600 hover:bg-indigo-700 transition">Guardar Cambios</button>
            </div>
        </div>
    </div>
</body>
</html>
